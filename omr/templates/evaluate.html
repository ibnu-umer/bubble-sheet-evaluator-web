{% extends 'base.html' %} {% block title %}OMR Evaluator{% endblock %}
{% load static %}
{% block content %}

<h1>OMR Evaluation</h1>

{% if messages %}
<ul>
    {% for m in messages %}
    <li>{{ m }}</li>
    {% endfor %}
</ul>
{% endif %}

<form method="post" enctype="multipart/form-data" id="process-form" action="{% url 'evaluator' %}">
    {% csrf_token %}

    <h2>Select a Sheet Template</h2>
    <div class="template-options mb-6">
        {% for t in templates %}
        <div class="template-card">
            <input type="radio" id="{{ t }}" name="sheet_template" value="{{ t }}" required />
            <label for="{{ t }}">{{ t }}</label>
            <button class="preview-btn" type="button" data-img="{% static 'sheet_images/' %}{{ t }}.png">
                Preview
            </button>
        </div>
        {% endfor %}
    </div>

    <div class="preview-overlay" id="previewOverlay">
        <span class="close-btn" id="closePreview">&times;</span>
        <img id="previewImage" src="" alt="Template Preview" />
    </div>

    <h3>Exam Date</h3>
    <input for="exam-date" name="exam_date" type="date" id="dateInput" />

    <h3>Exam Name</h3>
    <input for="exam-name" name="exam_name" type="text" required />

    <h3>College/School Name</h3>
    <input for="org-name" name="org_name" type="text" required />

    <h3>Subject</h3>
    <input for="subject" name="subject" type="text" required />

    <h3>Pass Mark</h3>
    <input for="pass-mark" name="pass_mark" type="number" required />

    <!-- Upload Section -->
    <h3>Upload Files</h3>
    <div>
        <label for="sheet_upload">Upload Sheet PDFs:</label>
        <input type="file" name="sheet_files" id="sheet_upload" accept=".pdf" multiple required />
        <ul id="sheetList"></ul>
    </div>

    <div>
        <label for="answer_upload">Upload Answer Key (CSV/JSON):</label>
        <input type="file" name="answer_file" id="answer_upload" accept=".csv,.json" required />
        <ul id="answerList"></ul>
    </div>

    <button type="submit" id="process-button">Start Processing</button>
</form>

<h1>Processing Sheets</h1>
<div id="progress-container">
    <div id="progress-bar">0%</div>
</div>

<div id="results" style="display: none"></div>
{% endblock %}
